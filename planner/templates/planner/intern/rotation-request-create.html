<div class="example-modal">
  <div class="modal">
    <div class="modal-dialog">
      <form name="{{ form.form_name }}" novalidate>
        <div class="modal-content">

          <div class="modal-header">
            {% verbatim %}
            <h3 class="modal-title">Request a rotation for {{ internshipMonth.label }}</h3>
            {% endverbatim %}
          </div>

          <div class="modal-body">

            <p>Please select the specialty and hospital you want to rotate in from the lists below.</p>

            {# FIXME: This is not a DRY solution. There is no need ideally for the fields to be redefined again here. #}

            {% verbatim %}
            <div class="has-feedback form-group"><label class="control-label" for="id_department_specialty">Specialty</label><select class="form-control" id="id_department_specialty" name="department_specialty" ng-model="rotationRequestData[&#39;department_specialty&#39;]">
              <option value="" selected="selected">---------</option>
              <option ng-repeat="specialty in specialties" value="{{ specialty.id }}">{{ specialty.name }}</option>
            </select><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_specialty.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_specialty'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_specialty.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_specialty.$message" class="invalid" ng-bind="rotationRequestForm.department_specialty.$message"></li></ul></div>

            <div class="has-feedback form-group"><label class="control-label" for="id_department_hospital">Hospital</label>
              <ui-select id="id_department_hospital" name="department_hospital" ng-model="rotationRequestData.department_hospital" theme="bootstrap" ng-disabled="disableHospitalMenu"><!-- FIXME: Enable searching -->
                <ui-select-match placeholder="Select or search for a hospital in the list...">{{ $select.selected.name }}</ui-select-match>
                <ui-select-choices repeat="hospital.id as hospital in hospitals" ui-disable-choice="hospital.department.acceptance_settings.can_submit_requests == false">
                  <div ng-bind-html="hospital.name"></div>
                  <small ng-if="hospital.department.id" ng-init="$settings = hospital.department.acceptance_settings"><i class="text-gray">
                    <span ng-if="$settings.can_submit_requests == true">
                      <span ng-if="$settings.total_seats == null">
                        Data on seat count and submission dates not available
                      </span>
                      <span ng-if="$settings.total_seats !== null">
                        <span class="text-bold">Submission OPEN</span> | Acceptance Criterion: {{ $settings.criterion }} | Total Seats: {{ $settings.total_seats }}

                        <span ng-if="$settings.criterion == 'FCFS'">
                          | Available: {{ $settings.available_seats }}
                        </span>

                        <span ng-if="$settings.criterion == 'GPA' && moment().isBefore(moment($settings.start_or_end_date))">
                          | Will close on {{ moment($settings.start_or_end_date).format('D MMMM YYYY hh:mm a') }}
                        </span>
                      </span>
                    </span>
                    <span ng-if="$settings.can_submit_requests == false">
                      Acceptance Criterion: {{ $settings.criterion }}
                      <span ng-if="$settings.criterion == 'FCFS' && $settings.available_seats == 0">
                        | No available seats
                      </span>
                      <span ng-if="$settings.criterion == 'FCFS' && moment().isBefore(moment($settings.start_or_end_date))">
                        | Submission will open on {{ moment($settings.start_or_end_date).format('D MMMM YYYY hh:mm a') }} | Total Seats: {{ $settings.total_seats }}
                      </span>
                      <span ng-if="$settings.criterion == 'GPA' && moment().isSameOrAfter(moment($settings.start_or_end_date))">
                        | Submission was closed on {{ moment($settings.start_or_end_date).format('D MMMM YYYY hh:mm a') }}  | Total Seats: {{ $settings.total_seats }}
                      </span>
                    </span>
                  </i></small>
                  <small ng-if="!hospital.department.id">
                    <i class="text-gray">Data on seat count and submission dates not available</i>
                  </small>
                </ui-select-choices>
              </ui-select>

            <ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_hospital.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_hospital'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_hospital.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_hospital.$message" class="invalid" ng-bind="rotationRequestForm.department_hospital.$message"></li></ul></div>
            {% endverbatim %}

            <div class="has-feedback form-group"><label class="checkbox-inline"><input id="id_is_elective" name="is_elective" ng-model="rotationRequestData[&#39;is_elective&#39;]" type="checkbox" /> <span class="text-bold">This is an elective.</span> (Check this box if this is an elective rotation.)</label><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.is_elective.$dirty" ng-cloak><li ng-show="rotationRequestForm['is_elective'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.is_elective.$pristine" ng-cloak><li ng-show="rotationRequestForm.is_elective.$message" class="invalid" ng-bind="rotationRequestForm.is_elective.$message"></li></ul>

            <div ng-if="rotationRequestData.is_in_database == false">

              <hr>

              <p>
                It appears we don't have the contact details for this specialty's department within the hospital you chose.
                Kindly provide us with these details below.
              </p>

              <div class="has-feedback form-group"><label class="control-label" for="id_department_name">Name of Department</label><input class="form-control" id="id_department_name" maxlength="128" name="department_name" ng-maxlength="128" ng-model="rotationRequestData[&#39;department_name&#39;]" type="text" /><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_name.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_name'].$error.maxlength" class="invalid">Ensure this value has at most 128 characters</li><li ng-show="rotationRequestForm['department_name'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_name.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_name.$message" class="invalid" ng-bind="rotationRequestForm.department_name.$message"></li></ul></div>
              <div class="has-feedback form-group"><label class="control-label" for="id_department_contact_name">Name of Contact Person in the Department</label><input class="form-control" id="id_department_contact_name" maxlength="128" name="department_contact_name" ng-maxlength="128" ng-model="rotationRequestData[&#39;department_contact_name&#39;]" type="text" /><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_contact_name.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_contact_name'].$error.maxlength" class="invalid">Ensure this value has at most 128 characters</li><li ng-show="rotationRequestForm['department_contact_name'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_contact_name.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_contact_name.$message" class="invalid" ng-bind="rotationRequestForm.department_contact_name.$message"></li></ul></div>
              <div class="has-feedback form-group"><label class="control-label" for="id_department_email">Email</label><input class="form-control" email-pattern="(^[-!#$%&amp;&#39;*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&amp;&#39;*+/=?^_`{}|~0-9A-Z]+)*@|^&quot;([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-\011\013\014\016-\177])*&quot;@)(localhost$|((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+)(?:[A-Z0-9-]{2,63})$)" id="id_department_email" maxlength="128" name="department_email" ng-model="rotationRequestData[&#39;department_email&#39;]" type="email" /><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_email.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_email'].$error.email" class="invalid">Enter a valid email address.</li><li ng-show="rotationRequestForm['department_email'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_email.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_email.$message" class="invalid" ng-bind="rotationRequestForm.department_email.$message"></li></ul></div>
              <div class="has-feedback form-group"><label class="control-label" for="id_department_phone">Phone</label><input class="form-control" id="id_department_phone" maxlength="128" name="department_phone" ng-maxlength="128" ng-model="rotationRequestData[&#39;department_phone&#39;]" type="text" /><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_phone.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_phone'].$error.maxlength" class="invalid">Ensure this value has at most 128 characters</li><li ng-show="rotationRequestForm['department_phone'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_phone.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_phone.$message" class="invalid" ng-bind="rotationRequestForm.department_phone.$message"></li></ul></div>
              <div class="has-feedback form-group"><label class="control-label" for="id_department_extension">Extension</label><input class="form-control" id="id_department_extension" maxlength="16" name="department_extension" ng-maxlength="16" ng-model="rotationRequestData[&#39;department_extension&#39;]" type="text" /><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_extension.$dirty" ng-cloak><li ng-show="rotationRequestForm['department_extension'].$error.maxlength" class="invalid">Ensure this value has at most 16 characters</li><li ng-show="rotationRequestForm['department_extension'].$valid" class="valid"></li></ul><ul class="djng-form-control-feedback djng-field-errors" ng-show="rotationRequestForm.department_extension.$pristine" ng-cloak><li ng-show="rotationRequestForm.department_extension.$message" class="invalid" ng-bind="rotationRequestForm.department_extension.$message"></li></ul>
              <input class="form-control ng-pristine ng-untouched ng-valid ng-empty" id="id_department" name="department" ng-model="rotationRequestData['department']" type="hidden">
              <input class="form-control ng-pristine ng-untouched ng-valid ng-empty" id="id_is_in_database" name="is_in_database" ng-model="rotationRequestData['is_in_database']" type="hidden"></div>
            </div>

          </div><!-- /.modal-body -->

          <div class="modal-footer">
            <a type="button" class="btn btn-default pull-left" href="javascript:history.back()">Back</a>
            <button type="button" class="btn btn-primary" ng-click="submit()" ng-disabled="{{ form.form_name }}.$invalid">Submit</button>
          </div>

        </div><!-- /.modal-content -->
      </form>
    </div><!-- /.modal-dialog -->
  </div>
</div>



