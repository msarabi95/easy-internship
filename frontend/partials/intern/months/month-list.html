<section class="content-header">
  <h1>
    Internship Planner
  </h1>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="box box-solid">
        <div class="box-header">
          <h5 class="box-title"><b>Welcome to the Internship Planner!</b></h5>
        </div>
        <div class="box-body">

          Each of the boxes below represents a month in which you can have a clinical rotation.
          You can make new requests and view the status of your current and previous ones.
          Each request you make is submitted to the medical internship unit for review and approval.<br>
          <span class="text-blue">Click on <span class="text-bold">Request a Rotation</span> for any of the months below and make your first request!</span>

          <span ng-if="intern.is_ksauhs_intern || intern.is_agu_intern">
            <br><br>
            Keep in mind that you have to satisfy the requirement of 2 months in each of <span class="text-bold">Internal Medicine, Surgery,
            Obstetrics and Gynecology, and Pediatrics</span>, having one general month at least in each specialty. In addition,
            you have 1 required month in <span class="text-bold">Emergency Medicine</span> and another in
            <span class="text-bold">Family Medicine</span>, plus 2 months of electives.
          </span>


        </div>
      </div>
    </div>
  </div>
</section>

<section class="content">

<style type="text/css">
  @media (min-width: 992px) {
    div#grid-container {
      margin-right: -110px;
      margin-left: -110px;
    }
  }

  [ng-repeat].ng-enter {
    animation: fadeIn 1s;
  }
</style>


<div ng-hide="months.$promise.$$state.status == 1" style="height: 150px;">
  <img src="/static/loading.gif" height="50" style="position: absolute; top: 50%; left: 50%; margin-left: -15px; margin-top: -15px;" />
</div>

<div id="grid-container">

      <!-- Check out: -->
      <!-- http://stackoverflow.com/a/25838091 -->
      <div class="row" ng-repeat="month in months track by $index" ng-if="$index % 5 == 0" ng-animate-children>

        <div class="col-md-2" ng-class="{'col-md-offset-1': $index % 5 == 0}" ng-repeat="i in [$index, $index + 1, $index + 2, $index + 3, $index + 4]">

          <div class="box direct-chat direct-chat-primary internship-month" ng-class="['box-' + getTileClass(months[i]), {'text-gray': months[i].disabled}]">
            <div class="box-header with-border">
              <h3 class="box-title">{{ months[i].label }}</h3>
              <div class="box-tools pull-right">
                <!--<span ng-if="months[i].current_leave_requests.length > 0 || months[i].current_leaves.length > 0"
                      uib-popover-template="'leave-summary-popover.html'"
                      popover-title="Leaves for {{ months[i].label }}"
                      popover-append-to-body="true"
                      class="badge"
                      ng-class="{'bg-yellow': months[i].current_leave_requests.length > 0, 'bg-light-blue': months[i].current_leave_requests.length == 0}">
                  <i class="fa fa-plane"></i>
                </span>-->
                <!-- See bottom of this file for templates -->
              </div>
            </div><!-- /.box-header -->
            <div class="box-body">
              <div class="col-xs-12" style="height: 130px; position: relative;">
                <!-- Regarding the CSS centering , check: https://css-tricks.com/centering-css-complete-guide/#both-unknown -->
                <div style="width: 95%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                  <div ng-if="!months[i].frozen && !months[i].disabled">
                    <div ng-if="!months[i].occupied && !months[i].requested">
                      <!-- #1 Not Occupied, Not Requested -->
                      <div ng-if="!months[i].current_freeze_request">
                        <h3 class="text-center">No rotation</h3>
                      </div>
                      <div ng-if="!!months[i].current_freeze_request">
                        <h3 class="text-center text-yellow">Freeze Pending</h3>
                      </div>
                    </div>

                    <div ng-if="!months[i].occupied && months[i].requested">
                      <!-- #2 Not Occupied, Requested -->
                      <h3 class="text-yellow text-center">Pending</h3>
                      <h4 class="text-yellow text-center">
                        {{ months[i].current_request.specialty.name }}
                        <small ng-if="months[i].current_request.is_elective">(Elective)</small>
                      </h4>
                      <h5 class="text-center">{{ months[i].current_request.requested_department.department.hospital.name }}</h5>
                    </div>

                    <div ng-if="months[i].occupied && !months[i].requested">
                      <!-- #3 Occupied, Not Requested -->
                      <h3 class="text-blue text-center">
                        {{ months[i].current_rotation.department.specialty.name }}
                        <small ng-if="months[i].current_rotation.is_elective">(Elective)</small>
                      </h3>
                      <h5 class="text-center">{{ months[i].current_rotation.department.hospital.name }}</h5>
                    </div>

                    <div ng-if="months[i].occupied && months[i].requested">
                      <!-- #4 Occupied, Requested -->
                      <h5 class="text-blue text-center">
                        Current: {{ months[i].current_rotation.department.specialty.name }}
                        <small ng-if="months[i].current_rotation.is_elective">(Elective)</small>
                      </h5>
                      <h6 class="text-center">{{ months[i].current_rotation.department.hospital.name }}</h6>

                      <hr style="margin-top: 5px; margin-bottom: 5px;">

                      <div ng-if="months[i].current_request.is_delete">
                        <h5 class="text-red text-center">Pending</h5>
                        <h6 class="text-center">Rotation to be cancelled</h6>
                      </div>

                      <div ng-if="!months[i].current_request.is_delete">
                        <h5 class="text-yellow text-center">
                          Pending: {{ months[i].current_request.specialty.name }}
                          <small ng-if="months[i].current_request.is_elective">(Elective)</small>
                        </h5>
                        <h6 class="text-center">{{ months[i].current_request.requested_department.department.hospital.name }}</h6>
                      </div>

                    </div>
                  </div>
                  <div ng-if="months[i].disabled">
                    <h5 class="text-center" ng-if="!intern.is_outside_intern">This month will be available when you have an approved freeze.</h5>
                    <h4 class="text-center" ng-if="intern.is_outside_intern">This month is not available.</h4>
                  </div>
                  <div ng-if="months[i].frozen">
                    <h3 class="text-center text-aqua"><i class="fa fa-snowflake-o"></i> Frozen</h3>
                    <div ng-if="months[i].current_freeze_cancel_request">
                      <h5 class="text-center text-yellow">(Pending Freeze Cancellation)</h5>
                    </div>
                  </div>
                </div>

              </div>

            </div><!-- /.box-body -->

            <div class="box-footer">
              <div ng-if="!months[i].disabled && !months[i].frozen">
                <div ng-if="!months[i].occupied && !months[i].requested">
                  <!-- #1 Not Occupied, Not Requested -->
                  <div class="btn-group" ng-if="!months[i].current_freeze_request">
                    <a type="button" class="btn btn-default btn-flat" href="#/planner/{{ months[i].month }}/new/">Request a rotation</a>
                    <button type="button" class="btn btn-default btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span class="caret"></span>
                      <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                      <li ng-if="intern.is_ksauhs_intern || intern.is_agu_intern"><a href="#/planner/{{ months[i].month }}/freeze/">Request a freeze</a></li>
                      <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                    </ul>
                  </div>
                  <div class="btn-group" ng-if="months[i].current_freeze_request">
                    <a class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat" href="#/planner/{{ months[i].month }}/">Get more info</a>
                    <button type="button" class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span class="caret"></span>
                      <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                      <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                    </ul>
                  </div>
                </div>

                <div class="btn-group" ng-if="!months[i].occupied && months[i].requested">
                  <!-- #2 Not Occupied, Requested -->
                  <a class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat" href="#/planner/{{ months[i].month }}/">Get more info</a>
                  <button type="button" class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                  </ul>
                </div>

                <div class="btn-group btn-group-xs" ng-if="months[i].occupied && !months[i].requested">
                  <!-- #3 Occupied, Not Requested -->
                  <a class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat" href="#/planner/{{ months[i].month }}/">Get more info</a>
                  <button type="button" class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="#/planner/{{ months[i].month }}/new/">Request a different rotation</a></li>
                    <li><a href="#/planner/{{ months[i].month }}/cancel/">Cancel this rotation</a></li>
                    <!--<li class="divider"></li>
                    <li><a href="#/planner/{{ months[i].month }}/leaves/new/">Request a leave during this month</a></li>
                    <li class="divider"></li>-->
                    <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                    <!--<li><a href="#/planner/{{ months[i].month }}/leaves/history/">See previous leave requests for this month</a></li>-->
                  </ul>
                </div>

                <div class="btn-group btn-group-xs" ng-if="months[i].occupied && months[i].requested">
                  <!-- #4 Occupied, Requested -->
                  <a class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat" href="#/planner/{{ months[i].month }}/">Get more info</a>
                  <button type="button" class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                  </ul>
                </div>
              </div>

              <div class="btn-group btn-group-xs" ng-if="months[i].frozen">
                <a class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat" href="#/planner/{{ months[i].month }}/">Get more info</a>
                  <button type="button" class="btn btn-xs btn-{{ getTileClass(months[i]) }} btn-flat dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <ul class="dropdown-menu">
                    <li ng-if="!months[i].current_freeze_cancel_request"><a href="#/planner/{{ months[i].month }}/freeze/cancel/">Cancel this freeze</a></li>
                    <li><a href="#/planner/{{ months[i].month }}/history/">See previous requests for this month</a></li>
                  </ul>
              </div>

            </div><!-- /.box-footer-->
          </div><!--/.direct-chat -->

        </div>
      </div>
  </div>
</section>

<script type="text/ng-template" id="leave-summary-popover.html">
  <div class="text-sm" ng-if="months[i].current_leaves.length > 0">
    <h5 class="text-bold text-light-blue"><i class="fa fa-check-circle-o"></i> Active</h5>
    <ul style="padding-left: 20px;">
      <li ng-repeat="leave in months[i].current_leaves">
        <span class="text-bold">{{ leave.type.name }}</span>
        from {{ moment(leave.start_date).format('Do of MMMM') }} to {{ moment(leave.end_date).format('Do of MMMM') }}
      </li>
    </ul>
  </div>

  <hr style="margin-top: 5px; margin-bottom: 5px;"
    ng-if="months[i].current_leaves.length > 0 && months[i].current_leave_requests.length > 0">

  <div class="text-sm" ng-if="months[i].current_leave_requests.length > 0">
    <h5 class="text-bold text-yellow"><i class="fa fa-clock-o"></i> Pending</h5>
    <ul style="padding-left: 20px;">
      <li ng-repeat="leave_request in months[i].current_leave_requests">
        <span class="text-bold">{{ leave_request.type.name }}</span>
        from {{ moment(leave_request.start_date).format('Do of MMMM') }} to {{ moment(leave_request.end_date).format('Do of MMMM') }}
      </li>
    </ul>
  </div>

  <hr style="margin-top: 5px; margin-bottom: 5px;">

  <p class="text-gray" style="font-size: 0.8em;"><i>Click "Get more info" below to view the full details about your leaves.</i></p>
</script>